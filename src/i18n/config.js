//===============================================
//üåç CONFIGURACI√ìN INTERNACIONAL EXPANDIDA
//===============================================
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

// Importar traducciones base
import esTranslations from './locales/es.json';

//===============================================
//üîí CONFIGURACI√ìN DE SEGURIDAD EXPANDIDA
//===============================================
// Lista expandida de idiomas soportados (12 idiomas principales)
const SUPPORTED_LANGUAGES = [
  'es', 'en', 'ru', 'ro', 'pl', 'uk',  // Originales
  'mk', 'de', 'fr', 'it', 'pt', 'nl'  // Nuevos
];

// Funci√≥n validadora mejorada
const validateLanguage = (lang) => {
  return SUPPORTED_LANGUAGES.includes(lang) ? lang : 'es';
};

//===============================================
//üá¨üáß TRADUCCIONES INGL√âS
//===============================================
const enTranslations = {
  nav: {
    properties: "Properties",
    experiences: "Experiences",
    services: "Services",
    contact: "Contact",
    login: "Login"
  },
  hero: {
    title: "Discover Cantabria",
    subtitle: "Exclusive properties and premium experiences",
    cta: "Explore Properties"
  },
  auth: {
    loginTitle: "Access your account",
    registerTitle: "Create account",
    email: "Email",
    password: "Password",
    confirmPassword: "Confirm password",
    loginButton: "Login",
    registerButton: "Register",
    switchToRegister: "Don't have an account? Register",
    switchToLogin: "Already have an account? Login",
    errors: {
      emailRequired: "Email is required",
      emailInvalid: "Please enter a valid email address",
      passwordRequired: "Password is required",
      passwordWeak: "Password must be at least 8 characters",
      confirmPasswordRequired: "You must confirm your password",
      passwordMismatch: "Passwords do not match",
      submitError: "Error processing request. Please try again."
    }
  },
  common: {
    close: "Close",
    loading: "Loading...",
    error: "Error"
  }
};

//===============================================
//üá∑üá∫ TRADUCCIONES RUSO
//===============================================
const ruTranslations = {
  nav: {
    properties: "–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å",
    experiences: "–û–ø—ã—Ç",
    services: "–£—Å–ª—É–≥–∏",
    contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã",
    login: "–í–æ–π—Ç–∏"
  },
  hero: {
    title: "–û—Ç–∫—Ä–æ–π—Ç–µ –ö–∞–Ω—Ç–∞–±—Ä–∏—é",
    subtitle: "–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å –∏ –ø—Ä–µ–º–∏—É–º –æ–ø—ã—Ç",
    cta: "–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å"
  },
  auth: {
    loginTitle: "–í–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç",
    registerTitle: "–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç",
    email: "–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞",
    password: "–ü–∞—Ä–æ–ª—å",
    confirmPassword: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–∞—Ä–æ–ª—å",
    loginButton: "–í–æ–π—Ç–∏",
    registerButton: "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è",
    switchToRegister: "–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è",
    switchToLogin: "–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏",
    errors: {
      emailRequired: "Email –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω",
      emailInvalid: "–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π email",
      passwordRequired: "–ü–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω",
      passwordWeak: "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤",
      confirmPasswordRequired: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å",
      passwordMismatch: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç",
      submitError: "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    }
  },
  common: {
    close: "–ó–∞–∫—Ä—ã—Ç—å",
    loading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
    error: "–û—à–∏–±–∫–∞"
  }
};

//===============================================
//üá∑üá¥ TRADUCCIONES RUMANO
//===============================================
const roTranslations = {
  nav: {
    properties: "ProprietƒÉ»õi",
    experiences: "Experien»õe",
    services: "Servicii",
    contact: "Contact",
    login: "Autentificare"
  },
  hero: {
    title: "DescoperƒÉ Cantabria",
    subtitle: "ProprietƒÉ»õi exclusive »ôi experien»õe premium",
    cta: "ExploreazƒÉ proprietƒÉ»õile"
  },
  auth: {
    loginTitle: "AcceseazƒÉ contul",
    registerTitle: "CreeazƒÉ cont",
    email: "Email",
    password: "ParolƒÉ",
    confirmPassword: "ConfirmƒÉ parola",
    loginButton: "Autentificare",
    registerButton: "√énregistrare",
    switchToRegister: "Nu ai cont? √énregistreazƒÉ-te",
    switchToLogin: "Ai deja cont? AutentificƒÉ-te",
    errors: {
      emailRequired: "Email-ul este obligatoriu",
      emailInvalid: "Introduce»õi o adresƒÉ de email validƒÉ",
      passwordRequired: "Parola este obligatorie",
      passwordWeak: "Parola trebuie sƒÉ aibƒÉ cel pu»õin 8 caractere",
      confirmPasswordRequired: "Trebuie sƒÉ confirma»õi parola",
      passwordMismatch: "Parolele nu se potrivesc",
      submitError: "Eroare la procesarea cererii. √éncerca»õi din nou."
    }
  },
  common: {
    close: "√énchide",
    loading: "Se √ÆncarcƒÉ...",
    error: "Eroare"
  }
};

//===============================================
//üáµüá± TRADUCCIONES POLACO
//===============================================
const plTranslations = {
  nav: {
    properties: "Nieruchomo≈õci",
    experiences: "Do≈õwiadczenia",
    services: "Us≈Çugi",
    contact: "Kontakt",
    login: "Zaloguj"
  },
  hero: {
    title: "Odkryj Kantabriƒô",
    subtitle: "Ekskluzywne nieruchomo≈õci i premium do≈õwiadczenia",
    cta: "PrzeglƒÖdaj nieruchomo≈õci"
  },
  auth: {
    loginTitle: "Zaloguj siƒô",
    registerTitle: "Utw√≥rz konto",
    email: "Email",
    password: "Has≈Ço",
    confirmPassword: "Potwierd≈∫ has≈Ço",
    loginButton: "Zaloguj",
    registerButton: "Zarejestruj",
    switchToRegister: "Nie masz konta? Zarejestruj siƒô",
    switchToLogin: "Masz ju≈º konto? Zaloguj siƒô",
    errors: {
      emailRequired: "Email jest wymagany",
      emailInvalid: "Wprowad≈∫ prawid≈Çowy adres email",
      passwordRequired: "Has≈Ço jest wymagane",
      passwordWeak: "Has≈Ço musi mieƒá co najmniej 8 znak√≥w",
      confirmPasswordRequired: "Musisz potwierdziƒá has≈Ço",
      passwordMismatch: "Has≈Ça siƒô nie zgadzajƒÖ",
      submitError: "B≈ÇƒÖd przetwarzania ≈ºƒÖdania. Spr√≥buj ponownie."
    }
  },
  common: {
    close: "Zamknij",
    loading: "≈Åadowanie...",
    error: "B≈ÇƒÖd"
  }
};

//===============================================
//üá∫üá¶ TRADUCCIONES UCRANIANO
//===============================================
const ukTranslations = {
  nav: {
    properties: "–ù–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å",
    experiences: "–î–æ—Å–≤—ñ–¥",
    services: "–ü–æ—Å–ª—É–≥–∏",
    contact: "–ö–æ–Ω—Ç–∞–∫—Ç–∏",
    login: "–£–≤—ñ–π—Ç–∏"
  },
  hero: {
    title: "–í—ñ–¥–∫—Ä–∏–π—Ç–µ –ö–∞–Ω—Ç–∞–±—Ä—ñ—é",
    subtitle: "–ï–∫—Å–∫–ª—é–∑–∏–≤–Ω–∞ –Ω–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å —Ç–∞ –ø—Ä–µ–º—ñ—É–º –¥–æ—Å–≤—ñ–¥",
    cta: "–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –Ω–µ—Ä—É—Ö–æ–º—ñ—Å—Ç—å"
  },
  auth: {
    loginTitle: "–£–≤—ñ–π—Ç–∏ –≤ –∞–∫–∞—É–Ω—Ç",
    registerTitle: "–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç",
    email: "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞",
    password: "–ü–∞—Ä–æ–ª—å",
    confirmPassword: "–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –ø–∞—Ä–æ–ª—å",
    loginButton: "–£–≤—ñ–π—Ç–∏",
    registerButton: "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è",
    switchToRegister: "–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç—É? –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è",
    switchToLogin: "–í–∂–µ —î –∞–∫–∞—É–Ω—Ç? –£–≤—ñ–π—Ç–∏",
    errors: {
      emailRequired: "Email –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π",
      emailInvalid: "–í–≤–µ–¥—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π email",
      passwordRequired: "–ü–∞—Ä–æ–ª—å –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π",
      passwordWeak: "–ü–∞—Ä–æ–ª—å –ø–æ–≤–∏–Ω–µ–Ω –º—ñ—Å—Ç–∏—Ç–∏ –º—ñ–Ω—ñ–º—É–º 8 —Å–∏–º–≤–æ–ª—ñ–≤",
      confirmPasswordRequired: "–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å",
      passwordMismatch: "–ü–∞—Ä–æ–ª—ñ –Ω–µ –∑–±—ñ–≥–∞—é—Ç—å—Å—è",
      submitError: "–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∑–∞–ø–∏—Ç—É. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É."
    }
  },
  common: {
    close: "–ó–∞–∫—Ä–∏—Ç–∏",
    loading: "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...",
    error: "–ü–æ–º–∏–ª–∫–∞"
  }
};

//===============================================
//üá≤üá∞ TRADUCCIONES MACEDONIO (NUEVO)
//===============================================
const mkTranslations = {
  nav: {
    properties: "–ù–µ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏",
    experiences: "–ò—Å–∫—É—Å—Ç–≤–∞",
    services: "–£—Å–ª—É–≥–∏",
    contact: "–ö–æ–Ω—Ç–∞–∫—Ç",
    login: "–ù–∞—ò–∞–≤–∏ —Å–µ"
  },
  hero: {
    title: "–û—Ç–∫—Ä–∏—ò—Ç–µ —ò–∞ –ö–∞–Ω—Ç–∞–±—Ä–∏—ò–∞",
    subtitle: "–ï–∫—Å–∫–ª—É–∑–∏–≤–Ω–∏ –Ω–µ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–µ–º–∏—É–º –∏—Å–∫—É—Å—Ç–≤–∞",
    cta: "–ò—Å—Ç—Ä–∞–∂–µ—Ç–µ –Ω–µ–¥–≤–∏–∂–Ω–æ—Å—Ç–∏"
  },
  auth: {
    loginTitle: "–ü—Ä–∏—Å—Ç–∞–ø–µ—Ç–µ –Ω–∞ –≤–∞—à–∞—Ç–∞ —Å–º–µ—Ç–∫–∞",
    registerTitle: "–°–æ–∑–¥–∞—ò—Ç–µ —Å–º–µ—Ç–∫–∞",
    email: "–ï-–ø–æ—à—Ç–∞",
    password: "–õ–æ–∑–∏–Ω–∫–∞",
    confirmPassword: "–ü–æ—Ç–≤—Ä–¥–µ—Ç–µ –ª–æ–∑–∏–Ω–∫–∞",
    loginButton: "–ù–∞—ò–∞–≤–∏ —Å–µ",
    registerButton: "–†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞—ò —Å–µ",
    switchToRegister: "–ù–µ–º–∞—Ç–µ —Å–º–µ—Ç–∫–∞? –†–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞—ò—Ç–µ —Å–µ",
    switchToLogin: "–í–µ—ú–µ –∏–º–∞—Ç–µ —Å–º–µ—Ç–∫–∞? –ù–∞—ò–∞–≤–µ—Ç–µ —Å–µ",
    errors: {
      emailRequired: "–ï-–ø–æ—à—Ç–∞—Ç–∞ –µ –∑–∞–¥–æ–ª–∂–∏—Ç–µ–ª–Ω–∞",
      emailInvalid: "–í–Ω–µ—Å–µ—Ç–µ –≤–∞–ª–∏–¥–Ω–∞ –µ-–ø–æ—à—Ç–∞",
      passwordRequired: "–õ–æ–∑–∏–Ω–∫–∞—Ç–∞ –µ –∑–∞–¥–æ–ª–∂–∏—Ç–µ–ª–Ω–∞",
      passwordWeak: "–õ–æ–∑–∏–Ω–∫–∞—Ç–∞ –º–æ—Ä–∞ –¥–∞ –∏–º–∞ –Ω–∞—ò–º–∞–ª–∫—É 8 –∫–∞—Ä–∞–∫—Ç–µ—Ä–∏",
      confirmPasswordRequired: "–ú–æ—Ä–∞ –¥–∞ —ò–∞ –ø–æ—Ç–≤—Ä–¥–∏—Ç–µ –ª–æ–∑–∏–Ω–∫–∞—Ç–∞",
      passwordMismatch: "–õ–æ–∑–∏–Ω–∫–∏—Ç–µ –Ω–µ —Å–µ —Å–æ–≤–ø–∞—ì–∞–∞—Ç",
      submitError: "–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞. –û–±–∏–¥–µ—Ç–µ —Å–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ."
    }
  },
  common: {
    close: "–ó–∞—Ç–≤–æ—Ä–∏",
    loading: "–°–µ –≤—á–∏—Ç—É–≤–∞...",
    error: "–ì—Ä–µ—à–∫–∞"
  }
};

//===============================================
//üá©üá™ TRADUCCIONES ALEM√ÅN
//===============================================
const deTranslations = {
  nav: {
    properties: "Immobilien",
    experiences: "Erlebnisse",
    services: "Dienstleistungen",
    contact: "Kontakt",
    login: "Anmelden"
  },
  hero: {
    title: "Entdecke Kantabrien",
    subtitle: "Exklusive Immobilien und Premium-Erlebnisse",
    cta: "Immobilien erkunden"
  },
  auth: {
    loginTitle: "Auf Ihr Konto zugreifen",
    registerTitle: "Konto erstellen",
    email: "E-Mail",
    password: "Passwort",
    confirmPassword: "Passwort best√§tigen",
    loginButton: "Anmelden",
    registerButton: "Registrieren",
    switchToRegister: "Noch kein Konto? Registrieren",
    switchToLogin: "Bereits ein Konto? Anmelden",
    errors: {
      emailRequired: "E-Mail ist erforderlich",
      emailInvalid: "Bitte geben Sie eine g√ºltige E-Mail ein",
      passwordRequired: "Passwort ist erforderlich",
      passwordWeak: "Passwort muss mindestens 8 Zeichen haben",
      confirmPasswordRequired: "Sie m√ºssen Ihr Passwort best√§tigen",
      passwordMismatch: "Passw√∂rter stimmen nicht √ºberein",
      submitError: "Fehler bei der Verarbeitung. Bitte versuchen Sie es erneut."
    }
  },
  common: {
    close: "Schlie√üen",
    loading: "Wird geladen...",
    error: "Fehler"
  }
};

//===============================================
//üá´üá∑ TRADUCCIONES FRANC√âS
//===============================================
const frTranslations = {
  nav: {
    properties: "Propri√©t√©s",
    experiences: "Exp√©riences",
    services: "Services",
    contact: "Contact",
    login: "Se connecter"
  },
  hero: {
    title: "D√©couvrez la Cantabrie",
    subtitle: "Propri√©t√©s exclusives et exp√©riences premium",
    cta: "Explorer les propri√©t√©s"
  },
  auth: {
    loginTitle: "Acc√©dez √† votre compte",
    registerTitle: "Cr√©er un compte",
    email: "E-mail",
    password: "Mot de passe",
    confirmPassword: "Confirmer le mot de passe",
    loginButton: "Se connecter",
    registerButton: "S'inscrire",
    switchToRegister: "Pas de compte? S'inscrire",
    switchToLogin: "D√©j√† un compte? Se connecter",
    errors: {
      emailRequired: "L'e-mail est requis",
      emailInvalid: "Veuillez saisir un e-mail valide",
      passwordRequired: "Le mot de passe est requis",
      passwordWeak: "Le mot de passe doit contenir au moins 8 caract√®res",
      confirmPasswordRequired: "Vous devez confirmer votre mot de passe",
      passwordMismatch: "Les mots de passe ne correspondent pas",
      submitError: "Erreur de traitement. Veuillez r√©essayer."
    }
  },
  common: {
    close: "Fermer",
    loading: "Chargement...",
    error: "Erreur"
  }
};

//===============================================
//üáÆüáπ TRADUCCIONES ITALIANO
//===============================================
const itTranslations = {
  nav: {
    properties: "Propriet√†",
    experiences: "Esperienze",
    services: "Servizi",
    contact: "Contatto",
    login: "Accedi"
  },
  hero: {
    title: "Scopri la Cantabria",
    subtitle: "Propriet√† esclusive ed esperienze premium",
    cta: "Esplora propriet√†"
  },
  auth: {
    loginTitle: "Accedi al tuo account",
    registerTitle: "Crea account",
    email: "E-mail",
    password: "Password",
    confirmPassword: "Conferma password",
    loginButton: "Accedi",
    registerButton: "Registrati",
    switchToRegister: "Non hai un account? Registrati",
    switchToLogin: "Hai gi√† un account? Accedi",
    errors: {
      emailRequired: "L'e-mail √® obbligatoria",
      emailInvalid: "Inserisci un'e-mail valida",
      passwordRequired: "La password √® obbligatoria",
      passwordWeak: "La password deve contenere almeno 8 caratteri",
      confirmPasswordRequired: "Devi confermare la password",
      passwordMismatch: "Le password non corrispondono",
      submitError: "Errore di elaborazione. Riprova."
    }
  },
  common: {
    close: "Chiudi",
    loading: "Caricamento...",
    error: "Errore"
  }
};

//===============================================
//üáµüáπ TRADUCCIONES PORTUGU√âS
//===============================================
const ptTranslations = {
  nav: {
    properties: "Propriedades",
    experiences: "Experi√™ncias",
    services: "Servi√ßos",
    contact: "Contato",
    login: "Entrar"
  },
  hero: {
    title: "Descubra a Cant√°bria",
    subtitle: "Propriedades exclusivas e experi√™ncias premium",
    cta: "Explorar propriedades"
  },
  auth: {
    loginTitle: "Acesse sua conta",
    registerTitle: "Criar conta",
    email: "E-mail",
    password: "Senha",
    confirmPassword: "Confirmar senha",
    loginButton: "Entrar",
    registerButton: "Registrar",
    switchToRegister: "N√£o tem conta? Registre-se",
    switchToLogin: "J√° tem conta? Entre",
    errors: {
      emailRequired: "E-mail √© obrigat√≥rio",
      emailInvalid: "Digite um e-mail v√°lido",
      passwordRequired: "Senha √© obrigat√≥ria",
      passwordWeak: "A senha deve ter pelo menos 8 caracteres",
      confirmPasswordRequired: "Voc√™ deve confirmar sua senha",
      passwordMismatch: "As senhas n√£o coincidem",
      submitError: "Erro no processamento. Tente novamente."
    }
  },
  common: {
    close: "Fechar",
    loading: "Carregando...",
    error: "Erro"
  }
};

//===============================================
//üá≥üá± TRADUCCIONES HOLAND√âS
//===============================================
const nlTranslations = {
  nav: {
    properties: "Eigendommen",
    experiences: "Ervaringen",
    services: "Diensten",
    contact: "Contact",
    login: "Inloggen"
  },
  hero: {
    title: "Ontdek Cantabri√´",
    subtitle: "Exclusieve eigendommen en premium ervaringen",
    cta: "Verken eigendommen"
  },
  auth: {
    loginTitle: "Toegang tot uw account",
    registerTitle: "Account aanmaken",
    email: "E-mail",
    password: "Wachtwoord",
    confirmPassword: "Wachtwoord bevestigen",
    loginButton: "Inloggen",
    registerButton: "Registreren",
    switchToRegister: "Geen account? Registreer",
    switchToLogin: "Al een account? Inloggen",
    errors: {
      emailRequired: "E-mail is vereist",
      emailInvalid: "Voer een geldig e-mailadres in",
      passwordRequired: "Wachtwoord is vereist",
      passwordWeak: "Wachtwoord moet minstens 8 karakters hebben",
      confirmPasswordRequired: "U moet uw wachtwoord bevestigen",
      passwordMismatch: "Wachtwoorden komen niet overeen",
      submitError: "Verwerkingsfout. Probeer opnieuw."
    }
  },
  common: {
    close: "Sluiten",
    loading: "Laden...",
    error: "Fout"
  }
};

//===============================================
//üõ†Ô∏è DETECTOR DE IDIOMA PERSONALIZADO
//===============================================
const customDetector = {
  name: 'novaterraDetector',
  lookup: () => {
    const storedLang = localStorage.getItem('novaterra-language');
    if (storedLang && SUPPORTED_LANGUAGES.includes(storedLang)) {
      return storedLang;
    }
    
    const browserLang = navigator.language.split('-')[0];
    if (SUPPORTED_LANGUAGES.includes(browserLang)) {
      return browserLang;
    }
    
    return 'es';
  },
  cacheUserLanguage: (lng) => {
    if (SUPPORTED_LANGUAGES.includes(lng)) {
      localStorage.setItem('novaterra-language', lng);
    }
  }
};

//===============================================
//‚öôÔ∏è INICIALIZACI√ìN DEL SISTEMA I18N
//===============================================
i18n
  .use({
    type: 'languageDetector',
    detect: customDetector.lookup,
    init: () => {},
    cacheUserLanguage: customDetector.cacheUserLanguage
  })
  .use(initReactI18next)
  .init({
    resources: {
      es: { translation: esTranslations },
      en: { translation: enTranslations },
      ru: { translation: ruTranslations },
      ro: { translation: roTranslations },
      pl: { translation: plTranslations },
      uk: { translation: ukTranslations },
      mk: { translation: mkTranslations }, // MACEDONIO
      de: { translation: deTranslations }, // ALEM√ÅN
      fr: { translation: frTranslations }, // FRANC√âS
      it: { translation: itTranslations }, // ITALIANO
      pt: { translation: ptTranslations }, // PORTUGU√âS
      nl: { translation: nlTranslations }  // HOLAND√âS
    },
    
    fallbackLng: 'es',
    lng: validateLanguage(customDetector.lookup()),
    debug: process.env.NODE_ENV === 'development',
    
    interpolation: {
      escapeValue: true,
      formatSeparator: ',',
      format: (value, format) => {
        if (format === 'uppercase') return value.toUpperCase();
        if (format === 'lowercase') return value.toLowerCase();
        return value;
      }
    },
    
    react: {
      bindI18n: 'languageChanged loaded',
      bindI18nStore: 'added removed',
      transEmptyNodeValue: '',
      transSupportBasicHtmlNodes: false,
      transKeepBasicHtmlNodesFor: [],
      useSuspense: true
    },
    
    load: 'languageOnly',
    cleanCode: true,
    
    detection: {
      order: ['localStorage', 'navigator', 'htmlTag'],
      lookupLocalStorage: 'novaterra-language',
      caches: ['localStorage'],
      excludeCacheFor: ['cimode']
    }
  });

//===============================================
//üîß FUNCI√ìN HELPER MEJORADA
//===============================================
export const changeLanguageSafely = (newLang) => {
  const validLang = validateLanguage(newLang);
  if (validLang !== newLang) {
    console.warn(`Idioma ${newLang} no soportado, usando ${validLang}`);
  }
  return i18n.changeLanguage(validLang);
};

//===============================================
//üì§ EXPORTACIONES
//===============================================
export { SUPPORTED_LANGUAGES };
export default i18n;